@{
    ViewBag.Title = "KSYLData";
    Layout = "~/Views/Shared/_LayoutEditer.cshtml";
}
<script type="text/javascript" src="../../binary/dynaload.js?20"> </script>
<div>
    <table style="width:100%;height:20px;">
        <tr>
            <td class="panel-title" style="text-align:left;">停止刷新<input id="stopRefresh" onclick="stopRefresh(this)" type="checkbox" /></td>

        </tr>
    </table>
</div>
<div id="myGrid" class="easyui-panel" data-options="fit:true,onResize:function(){DivChange();}" onchange="DivChange()">
    <div style="height:96%;">
        <table id="dg" style="height:90%" class="easyui-datagrid">
            <thead>
                @*表头*@
                <tr>

                    <th field="TmpID" width="5%" hidden="true"> ID号</th>
                    <th field="SimpleName" width="15%">煤矿名称</th>
                    <th field="SensorNum" width="10%">测点编号</th>
                    <th field="TypeName" width="10%">设备名</th>
                    <th field="Place" width="20%">安装地点</th>
                    <th field="ShowValue" width="8%">测点值</th>
                    <th field="unit" width="5%">单位</th>
                    <th field="datetime" width="20%">监测时间</th>
                    <th field="ValueState" width="10%">状态</th>

                </tr>

            </thead>
        </table>
    </div>
</div>
<script type="text/javascript">
    var rows = 0;
    $(function () {
        debugger;
        $('#dg').datagrid({
            pagination: true,
            autoRowHeight: false,
            rownumbers: true,
            pageList: [rows]
        });
        var p = $('#dg').datagrid('getPager');
        $(p).pagination({
            layout: ['first', 'links', 'next','last','refresh'],
            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        });
        var total = $('#dg').datagrid('getPager').pagination("options").total;
        var count = parseInt(total / rows);
        alert(total + ";" + count);
        //setInterval("$('#dg').datagrid('getPager').pagination('select', 2)", 1000);

    });






    //获取URL参数的值
    function getParameterByName(name) {
        var queryname = name.toLowerCase();
        var match = RegExp('[?&]' + queryname + '=([^&]*)')
            .exec(window.location.search.toLowerCase());
        return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
    }

    var minecode = null;
  

    var times = 0;
    var mystopRefresh = false;
    //改变每页总行数
    function ChangeRowsLength() {
        var myHeight = parseInt($("#myGrid")[0].style.height.replace("px", ""));
        rows = parseInt((myHeight - 80) / 27);
        $("#dg").datagrid({
            pageSize: rows,
        });
    }

    //function stopRefresh(obj) {
    //    if (obj.checked) {
    //        AF.func("bBar.timerRoundPage", "ID0 \r\n 0");
    //    }
    //    else {
    //        AF.func("bBar.timerRoundPage", "ID0 \r\n 10000");
    //    }
    //}


    function DivChange() {
     ChangeRowsLength();
        LoadData();
    }

    //加载数据
    function LoadData() {
        //var urlq = "../TransJson/TransJsonToTreeList?DataType=RealData_KY&startRow=@@startRow&rows=@@rows" + getUrlStafix();
        //if (minecode != null)
        //    urlq = urlq + "&minecode=" + minecode;
        //var hBbar = AF.func("GetHandle", "bBar");//获取bBar句柄
        //AF.func(hBbar + "SetObjectProp", "ID0\r\n dataURL  \r\n" + urlq + "\r\n mode=asynch"); //让Treelist异步加载数据
      
       // var startRow = (opts.pageNumber - 1) * rows + 1;
         $("#dg").datagrid({
            
            //url: "../TransJson/TransJsonToTreeList?DataType=RealData_KY&startRow=" + startRow + "&rows=" + rows + getUrlStafix(),//page当前页数
             url: "../TransJson/TransJsonToTreeList?DataType=RealData_KY&rows="+rows + getUrlStafix(),//page当前页数


        });
    
    }


</script>
